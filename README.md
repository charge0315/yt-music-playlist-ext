# YouTube Music Playlist Extension

YouTube Musicの登録チャンネルから楽曲を自動収集し、プレイリストにまとめるChrome拡張機能

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

## 目次

- [概要](#概要)
- [主な機能](#主な機能)
- [スクリーンショット](#スクリーンショット)
- [インストール](#インストール)
- [使い方](#使い方)
- [技術仕様](#技術仕様)
- [アーキテクチャ](#アーキテクチャ)
- [トラブルシューティング](#トラブルシューティング)
- [開発](#開発)
- [制限事項](#制限事項)
- [FAQ](#faq)
- [ライセンス](#ライセンス)

## 概要

この拡張機能は、YouTube Musicで登録しているアーティスト/チャンネルから、最新の楽曲や人気曲を自動的に収集し、1つのプレイリストにまとめます。お気に入りのアーティストの新曲を逃さずチェックしたり、各アーティストの代表曲を集めたベストプレイリストを簡単に作成できます。

### 特徴

- **完全自動化**: ワンクリックで複数チャンネルから楽曲を収集
- **2つの取得モード**: 最新曲と人気曲から選択可能
- **柔軟な設定**: チャンネルごとの取得曲数やプレイリスト名をカスタマイズ
- **YouTube Music API統合**: 公式のような使い心地で安定動作
- **軽量・高速**: 必要最小限のリソースで動作

## 主な機能

### 1. 2つの取得モード

#### 最新曲モード
各チャンネルから最新アップロードされた楽曲を取得します。新曲リリースを追いかけるのに最適です。

**使用例:**
- 登録アーティストの新曲チェック
- 週次/月次で最新曲プレイリストを更新
- 新しい楽曲の発見

#### 人気曲モード
各チャンネルで最も再生回数の多い楽曲を取得します。アーティストの代表曲を集めたベストプレイリストの作成に最適です。

**使用例:**
- アーティストの代表曲コレクション
- 初めて聴く人向けの入門プレイリスト
- パーティー用の定番曲プレイリスト

### 2. カスタマイズ可能な設定

- **取得曲数**: 各チャンネルから1〜10曲まで設定可能
- **プレイリスト名**: 任意の名前を付けられる
- **既存プレイリスト**: 同名のプレイリストがあれば自動的に追加

### 3. スマートなプレイリスト管理

- 既存プレイリストの自動検出と再利用
- プレイリストの作成とプライバシー設定
- エラーハンドリングとリトライロジック

## スクリーンショット

*（今後追加予定）*

## インストール

### 前提条件

- Google Chrome または Chromiumベースのブラウザ（Edge, Brave等）
- YouTube Musicアカウント
- 登録チャンネル/アーティスト

### インストール手順

1. **リポジトリをクローン**

```bash
git clone https://github.com/charge0315/yt-music-playlist-ext.git
cd yt-music-playlist-ext
```

2. **Chrome拡張機能ページを開く**

- Chromeで `chrome://extensions/` にアクセス
- または メニュー → その他のツール → 拡張機能

3. **デベロッパーモードを有効化**

- 右上の「デベロッパーモード」トグルをONにする

4. **拡張機能を読み込む**

- 「パッケージ化されていない拡張機能を読み込む」をクリック
- クローンした `yt-music-playlist-ext` ディレクトリを選択

5. **インストール完了**

- 拡張機能リストに「YouTube Music Playlist Extension」が表示されます

## 使い方

### 基本的な使い方

1. **YouTube Musicを開く**
   - https://music.youtube.com にアクセス
   - ログインしていることを確認

2. **拡張機能を起動**
   - ブラウザのツールバーにある拡張機能アイコンをクリック

3. **取得モードを選択**
   - **最新曲**: チャンネルの最新アップロード曲を取得
   - **人気曲**: チャンネルで最も再生されている曲を取得

4. **設定を調整**
   - 各チャンネルから取得する曲数を入力（1〜10曲）
   - プレイリスト名を入力（例: "Latest from My Channels"）

5. **実行**
   - 「登録チャンネルから楽曲を取得」ボタンをクリック
   - 進捗状況がポップアップに表示されます

6. **完了**
   - プレイリストが作成され、YouTube Musicのライブラリに追加されます

### ユースケース別ガイド

#### ケース1: 最新曲プレイリストを毎週更新

```
モード: 最新曲
曲数: 3曲
プレイリスト名: Weekly New Releases
頻度: 週1回実行
```

毎週実行することで、常に最新の楽曲がプレイリストに追加されます。

#### ケース2: アーティストのベスト曲コレクション

```
モード: 人気曲
曲数: 1曲
プレイリスト名: Artist Best Collection
頻度: 初回のみ/月1回更新
```

各アーティストの代表曲を1曲ずつ集めた、入門者向けプレイリストを作成できます。

#### ケース3: 深掘りプレイリスト

```
モード: 最新曲 または 人気曲
曲数: 5〜10曲
プレイリスト名: Deep Dive into My Artists
頻度: 随時
```

各アーティストの楽曲を多めに取得して、じっくり聴き込むプレイリストを作成します。

## 技術仕様

### 技術スタック

- **Chrome Extension Manifest**: V3
- **言語**: JavaScript (ES6+)
- **対象プラットフォーム**: YouTube Music (music.youtube.com)
- **API**: YouTube Music 内部API (InnerTube API)

### ファイル構成

```
yt-music-playlist-ext/
├── manifest.json           # Chrome拡張機能の設定ファイル
├── popup.html             # ポップアップUIのHTML
├── popup.css              # ポップアップUIのスタイル
├── popup.js               # ポップアップUIのロジック
├── content.js             # YouTube Musicページで実行されるスクリプト
├── background.js          # バックグラウンドサービスワーカー
├── utils.js               # 共通ユーティリティ関数
├── icons/                 # 拡張機能のアイコン
│   ├── icon16.png
│   ├── icon48.png
│   └── icon128.png
├── README.md              # このファイル
├── DEVELOPMENT.md         # 開発者向けドキュメント
├── package.json           # プロジェクト設定
└── .gitignore            # Git除外設定
```

### 主要コンポーネント

#### Popup UI (popup.html/js/css)
ユーザーインターフェース。設定の入力と実行を担当。

#### Content Script (content.js)
YouTube Musicページに注入され、以下を実行:
- 登録チャンネルの取得
- チャンネルから楽曲情報の抽出
- プレイリストの作成と楽曲追加
- YouTube Music内部APIの呼び出し

#### Background Script (background.js)
バックグラウンド処理とログ管理。

#### Utilities (utils.js)
共通機能:
- リトライロジック
- レート制限
- タイムアウト処理
- エラーハンドリング

## アーキテクチャ

### データフロー

```
User Input (Popup)
    ↓
Content Script
    ↓
[1] getSubscribedChannels()
    ├─ YouTube Music API呼び出し
    └─ フォールバック: DOM解析
    ↓
[2] getLatestSongs() / getPopularSongs()
    ├─ 各チャンネルをループ処理
    └─ YouTube Music API呼び出し
    ↓
[3] getOrCreatePlaylist()
    ├─ 既存プレイリストを検索
    └─ 必要に応じて新規作成
    ↓
[4] addSongsToPlaylist()
    ├─ 一括追加を試行
    └─ 失敗時は1曲ずつリトライ
    ↓
Result (Popup に表示)
```

### YouTube Music API統合

この拡張機能は、YouTube Musicの内部API（InnerTube API）を使用しています。

**主要エンドポイント:**
- `browse`: コンテンツ取得（チャンネル、プレイリスト等）
- `playlist/create`: プレイリスト作成
- `browse/edit_playlist`: プレイリスト編集

**認証:**
- `window.ytcfg` からAPIキーとコンテキストを取得
- ユーザーのセッションクッキーを使用（`credentials: 'include'`）

## トラブルシューティング

### よくある問題と解決方法

#### 問題: 「YouTube Musicのページで実行してください」と表示される

**原因:** 拡張機能がYouTube Music以外のページで実行されている

**解決方法:**
1. https://music.youtube.com にアクセス
2. ページが完全に読み込まれたことを確認
3. 拡張機能を再度実行

#### 問題: 登録チャンネルが取得できない

**原因:** YouTube Musicにログインしていない、または登録チャンネルがない

**解決方法:**
1. YouTube Musicアカウントにログイン
2. チャンネル/アーティストを登録
3. ページをリロードして再試行

#### 問題: プレイリストが作成されない

**原因:** API呼び出しの失敗、または権限の問題

**解決方法:**
1. ブラウザの開発者ツール（F12）を開く
2. Consoleタブでエラーメッセージを確認
3. ページをリロードして再試行
4. 問題が続く場合は、既存のプレイリスト名を指定して追加を試みる

#### 問題: 一部のチャンネルから楽曲が取得できない

**原因:** チャンネルのコンテンツ構造が特殊、またはアクセス制限

**解決方法:**
- 正常に取得できたチャンネルの楽曲は追加されます
- エラーが発生したチャンネルはスキップされます
- 詳細はConsoleログを確認

#### 問題: 拡張機能が動作しない

**解決方法:**
1. Chrome拡張機能ページ（`chrome://extensions/`）を開く
2. 拡張機能の「再読み込み」ボタンをクリック
3. YouTube Musicのページをリロード
4. 問題が続く場合は、拡張機能を削除して再インストール

## 開発

開発者向けの詳細情報は [DEVELOPMENT.md](DEVELOPMENT.md) を参照してください。

### 必要な環境

- Node.js (推奨: v18以上)
- npm または yarn
- Google Chrome
- Git

### セットアップ

```bash
# リポジトリをクローン
git clone https://github.com/charge0315/yt-music-playlist-ext.git
cd yt-music-playlist-ext

# 依存関係をインストール（開発ツール用）
npm install
```

### デバッグ

1. **Content Scriptのログを確認**
   - YouTube MusicページでF12を押して開発者ツールを開く
   - Consoleタブを確認

2. **Background Scriptのログを確認**
   - `chrome://extensions/` を開く
   - 「サービスワーカー」のリンクをクリック

3. **ネットワークリクエストを監視**
   - 開発者ツールのNetworkタブを開く
   - Filter: `youtubei` で絞り込み

### コントリビュート

プルリクエストを歓迎します！

1. このリポジトリをフォーク
2. フィーチャーブランチを作成 (`git checkout -b feature/amazing-feature`)
3. 変更をコミット (`git commit -m 'Add amazing feature'`)
4. ブランチにプッシュ (`git push origin feature/amazing-feature`)
5. プルリクエストを作成

## 制限事項

### 技術的制限

1. **非公式API使用**
   - YouTube Musicの公式APIは存在しません
   - 内部APIを使用しているため、YouTube側の仕様変更で動作しなくなる可能性があります

2. **レート制限**
   - 過度なAPI呼び出しはアカウント制限につながる可能性があります
   - 現在は各チャンネル処理後に500msの待機時間を設けています

3. **ブラウザ依存**
   - Chrome/Chromiumベースのブラウザでのみ動作します
   - Firefoxには対応していません

### 機能的制限

1. **登録チャンネルのみ対象**
   - YouTube Musicで登録しているチャンネル/アーティストのみが対象です

2. **手動実行**
   - 現時点では自動実行機能はありません
   - 定期的に手動で実行する必要があります

3. **プレイリストの重複管理**
   - 同じ楽曲が複数回追加される可能性があります

## FAQ

### Q: この拡張機能は安全ですか？

A: はい。すべてのコードはオープンソースで公開されており、悪意のある動作は含まれていません。YouTube Musicの内部APIを使用していますが、ユーザーの認証情報を外部に送信することはありません。

### Q: YouTube Musicの利用規約に違反しませんか？

A: この拡張機能は、ブラウザで通常行う操作を自動化しているだけです。ただし、YouTube Musicの内部APIを使用しているため、将来的に利用が制限される可能性はあります。

### Q: 無料で使えますか？

A: はい、完全に無料です。オープンソースで提供されています。

### Q: YouTube Music Premiumが必要ですか？

A: いいえ、無料アカウントでも使用できます。

### Q: 自動で定期実行できますか？

A: 現時点では手動実行のみです。将来のバージョンで自動実行機能を追加する予定です。

### Q: 他のブラウザで使えますか？

A: Chrome/Chromiumベースのブラウザ（Edge, Brave等）で動作します。Firefoxには対応していません。

### Q: プレイリストを公開できますか？

A: プレイリストはプライベート設定で作成されますが、YouTube Music上で手動で公開設定に変更できます。

### Q: 取得できる楽曲の上限はありますか？

A: チャンネルごとに1〜10曲まで設定できます。チャンネル数に上限はありませんが、レート制限を考慮して適度に使用してください。

## ライセンス

MIT License

Copyright (c) 2024 charge0315

詳細は [LICENSE](LICENSE) ファイルを参照してください。

## 作者

**charge0315**

- GitHub: [@charge0315](https://github.com/charge0315)

## リポジトリ

https://github.com/charge0315/yt-music-playlist-ext

## 謝辞

- [ytmusicapi](https://github.com/sigma67/ytmusicapi) - YouTube Music APIの理解に参考にさせていただきました
- YouTube Music - 素晴らしい音楽ストリーミングサービス

---

**Note:** この拡張機能は非公式であり、Google/YouTubeとは関係ありません。
